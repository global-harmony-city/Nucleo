# 通信・ネットワーク基盤層 設計書（キャリア+Azure統合版）

## 1. 全体アーキテクチャ

### 基本方針
- **キャリア+Azure連携**: 物理回線はキャリア、クラウドはAzure
- **1000人規模最適化**: 過度なスペックを避け、実用性重視
- **段階的拡張**: 必要最小限から開始し、需要に応じて拡張
- **コスト効率**: 月額コスト 15-30万円程度を目標
- **既存基盤活用**: データ基盤・認証基盤との統合

## 2. 推奨サービス構成

### 2.1 キャリアサービス（物理・アクセス層）

#### **NTTドコモ 5G/LTE専用線**
- **用途**: 市内全域の5G/LTE基地局・回線
- **料金**: 月額 約80,000円（小規模基地局×3、専用線）
- **選定理由**: 全国展開、災害対応、IoT特化プラン

#### **NTT東日本 フレッツ光**
- **用途**: 主要施設間の固定回線バックボーン
- **料金**: 月額 約25,000円（1Gbps×5拠点）
- **選定理由**: 高い安定性、低遅延、既存インフラ活用

#### **KDDI IoT専用回線**
- **用途**: IoTセンサー・デバイス専用通信
- **料金**: 月額 約15,000円（500デバイス、LPWA）
- **選定理由**: 低消費電力、広域カバー、IoT特化

### 2.2 Azure ネットワークサービス

#### **Azure Virtual Network（既存拡張）**
- **用途**: クラウド内仮想ネットワーク
- **料金**: 標準機能（追加コストなし）
- **選定理由**: データ基盤・認証基盤と統合済み

#### **Azure VPN Gateway**
- **用途**: オンプレミス↔Azure接続
- **料金**: 月額 約12,000円（Basic SKU）
- **選定理由**: 安全な拠点間接続、シンプル設定

#### **Azure Load Balancer**
- **用途**: トラフィック分散・可用性向上
- **料金**: 月額 約3,000円（Standard）
- **選定理由**: 高可用性、自動フェイルオーバー

#### **Azure Content Delivery Network（CDN）**
- **用途**: 住民向けWebサービスの高速化
- **料金**: 月額 約8,000円（100GB転送）
- **選定理由**: レスポンス向上、帯域削減

### 2.3 SD-WAN・ネットワーク管理

#### **Azure Virtual WAN（Basic）**
- **用途**: 拠点間ネットワークの一元管理
- **料金**: 月額 約15,000円
- **選定理由**: 複数拠点の統合管理、ルーティング最適化

#### **Azure Network Watcher**
- **用途**: ネットワーク監視・診断
- **料金**: 月額 約2,000円
- **選定理由**: 問題の早期発見、パフォーマンス分析

### 2.4 セキュリティ・保護

#### **Azure Firewall（Basic）**
- **用途**: ネットワークセキュリティ・アクセス制御
- **料金**: 月額 約35,000円
- **選定理由**: 統合セキュリティ、脅威保護

#### **Azure DDoS Protection（Standard）**
- **用途**: DDoS攻撃からの保護
- **料金**: 月額 約30,000円
- **選定理由**: 自動防御、アプリケーション保護

### 2.5 エッジコンピューティング・IoT

#### **Azure IoT Edge**
- **用途**: 現地でのIoTデータ前処理
- **料金**: ソフトウェア（無料）+ ハードウェア
- **選定理由**: 低遅延処理、帯域節約

#### **Azure Stack Edge（Mini）**
- **用途**: エッジでのコンピューティング・ストレージ
- **料金**: 月額 約20,000円（サブスクリプション）
- **選定理由**: オフライン対応、ローカル処理

## 3. ネットワーク設計

### 3.1 物理ネットワーク構成
```yaml
拠点間バックボーン:
  市役所（中央拠点）:
    - NTT フレッツ光 1Gbps
    - 冗長化: 2回線（メイン・バックアップ）
    - 機器: L3スイッチ、ファイアウォール
  
  住宅エリア（4エリア）:
    - 各エリア: 光回線 100Mbps
    - WiFi AP: 各エリア 10箇所
    - 住民向け無料WiFi提供
  
  産業エリア:
    - 農業エリア: 専用線 100Mbps + IoT-LPWA
    - 製造エリア: 専用線 200Mbps + 5G
    - 商業エリア: 光回線 100Mbps

5G/LTE基地局配置:
  カバレッジ設計:
    - 基地局数: 3局（市全体カバー）
    - 周波数: Sub6（3.7GHz）+ ミリ波（28GHz）
    - 容量: 1Gbps共有（ピーク時）
  
  優先制御:
    - 緊急時: 救急・消防・警察優先
    - 平常時: 業務用 > 住民用
    - IoT: 専用スライス割り当て
```

### 3.2 Azure ネットワーク構成
```yaml
Virtual Network設計:
  メインVNet（10.0.0.0/16）:
    - データ基盤サブネット: 10.0.1.0/24
    - 認証基盤サブネット: 10.0.2.0/24
    - 住民サービスサブネット: 10.0.3.0/24
    - 業務システムサブネット: 10.0.4.0/24
    - 管理・監視サブネット: 10.0.5.0/24
  
  DMZサブネット（10.0.100.0/24）:
    - 外部向けWebサービス
    - VPN Gateway
    - Azure Firewall

オンプレ接続:
  Site-to-Site VPN:
    - 市役所: メイン接続
    - 各拠点: バックアップ接続
    - 暗号化: IPsec/IKE v2
  
  Point-to-Site VPN:
    - 在宅勤務職員: 10接続
    - 外部保守業者: 5接続
    - 緊急時リモートアクセス
```

### 3.3 WiFi・無線LAN設計
```yaml
住民向けWiFi:
  SSID構成:
    - "City-Free": 住民無料WiFi
    - "City-Staff": 職員専用
    - "City-Guest": 来訪者用（時間制限）
    - "City-IoT": IoTデバイス専用

セキュリティ設計:
  認証方式:
    - 住民: Azure AD B2C連携
    - 職員: Azure AD統合認証
    - ゲスト: SMS認証
  
  アクセス制御:
    - VLAN分離
    - 帯域制限（住民: 10Mbps/人）
    - Webフィルタリング
```

## 4. 段階的実装計画

### Phase 1: 基本インフラ構築（0-3ヶ月）
```yaml
実装サービス:
  キャリア:
    - フレッツ光 主要拠点
    - 基本的な5G基地局×1
  
  Azure:
    - Virtual Network 拡張
    - VPN Gateway
    - 基本Load Balancer

月額コスト: 約15万円

実装内容:
  - 主要拠点間の接続確立
  - 基本的なインターネット接続
  - データ基盤・認証基盤との接続
  - 職員向け基本ネットワーク
```

### Phase 2: 住民サービス展開（4-6ヶ月目）
```yaml
追加サービス:
  キャリア:
    - 5G基地局拡張×2
    - IoT専用回線
  
  Azure:
    - Azure Firewall
    - CDN
    - 住民向けWiFi基盤

月額コスト: 約22万円（累計）

実装内容:
  - 住民向け無料WiFi提供
  - IoTセンサーネットワーク
  - セキュリティ機能強化
  - 住民サービスの高速化
```

### Phase 3: 高度機能・監視（7-12ヶ月目）
```yaml
追加サービス:
  キャリア:
    - 冗長化回線
    - 災害対応機能
  
  Azure:
    - Virtual WAN
    - DDoS Protection
    - Network Watcher
    - Stack Edge

月額コスト: 約28万円（累計）

実装内容:
  - 完全な冗長化構成
  - 高度なセキュリティ保護
  - エッジコンピューティング
  - 包括的なネットワーク監視
```

## 5. IoT・センサーネットワーク

### 5.1 IoTデバイス接続方式
```yaml
短距離通信（建物内・近距離）:
  WiFi 6E:
    - 用途: 建物内センサー、カメラ
    - 台数: 200台
    - 帯域: 高速・大容量

  Bluetooth 5.2:
    - 用途: ウェアラブル、近接センサー
    - 台数: 100台
    - 特徴: 低消費電力

中距離通信（市内・広域）:
  LoRaWAN:
    - 用途: 農業センサー、環境モニタリング
    - 台数: 500台
    - 特徴: 長距離・低消費電力

  5G/LTE:
    - 用途: 車両、移動体、高速通信必要
    - 台数: 50台
    - 特徴: 高速・リアルタイム

長距離通信（災害時・山間部）:
  衛星通信:
    - 用途: 緊急時バックアップ
    - 台数: 10台
    - 特徴: 災害耐性
```

### 5.2 エッジコンピューティング配置
```yaml
エッジ拠点（5箇所）:
  中央拠点（市役所）:
    - Azure Stack Edge Pro
    - GPU搭載（AI処理）
    - ストレージ: 10TB

  各エリア拠点（4箇所）:
    - Azure Stack Edge Mini
    - 基本処理・キャッシュ
    - ストレージ: 2TB

処理分散:
  リアルタイム処理: エッジで実行
  バッチ処理: Azureクラウド
  AI分析: エッジ+クラウド連携
  長期保存: Data Lake Storage
```

## 6. セキュリティ・監視

### 6.1 ネットワークセキュリティ
```yaml
多層防御:
  境界防御:
    - Azure Firewall（L4-L7）
    - DDoS Protection
    - WAF（Web Application Firewall）

  内部防御:
    - VLAN分離
    - マイクロセグメンテーション
    - 内部通信の暗号化

  エンドポイント:
    - デバイス認証
    - 証明書ベース認証
    - デバイス管理（MDM）

侵入検知・防止:
  Azure Sentinel連携:
    - ネットワークログ分析
    - 異常通信検知
    - 自動対応・隔離
```

### 6.2 パフォーマンス監視
```yaml
監視項目:
  回線品質:
    - 帯域使用率
    - 遅延・ジッタ
    - パケットロス率
    - 可用性

  アプリケーション:
    - レスポンス時間
    - スループット
    - エラー率
    - ユーザー体験品質

自動アラート:
  - 帯域使用率 80%超過
  - 遅延 100ms超過
  - 可用性 99%未満
  - セキュリティインシデント
```

## 7. 災害対応・BCP

### 7.1 冗長化設計
```yaml
回線冗長化:
  メイン: NTT フレッツ光
  バックアップ: KDDI 光回線
  緊急時: ドコモ 5G/LTE
  最終手段: 衛星通信

電源冗長化:
  UPS: 各拠点 2時間分
  非常用発電機: 中央拠点 72時間
  太陽光+蓄電池: 各エリア拠点

データ冗長化:
  リアルタイム: Azure同期
  バックアップ: 毎日クラウド保存
  オフライン: エッジ機器ローカル保存
```

### 7.2 緊急時運用
```yaml
段階的復旧:
  Level 1: 基本通信確保（音声・緊急連絡）
  Level 2: 住民安否確認システム
  Level 3: 業務システム復旧
  Level 4: 通常サービス全面復旧

優先度設定:
  最優先: 救急・消防・警察
  高優先: 災害対策本部・避難所
  中優先: 医療・インフラ事業者
  低優先: 一般住民・その他
```

## 8. コスト詳細

### 8.1 月額運用コスト（Phase 3完成時）
```yaml
キャリアサービス:
  - ドコモ 5G/LTE: 80,000円
  - NTT フレッツ光: 25,000円
  - KDDI IoT回線: 15,000円

Azure ネットワーク:
  - Virtual WAN: 15,000円
  - Azure Firewall: 35,000円
  - DDoS Protection: 30,000円
  - VPN Gateway: 12,000円
  - Load Balancer: 3,000円
  - CDN: 8,000円
  - Network Watcher: 2,000円

エッジ・ハードウェア:
  - Stack Edge: 20,000円
  - WiFi AP・機器: 10,000円

月額合計: 約255,000円
年間コスト: 約306万円
```

### 8.2 初期構築費用
```yaml
設計・構築: 800万円
  - ネットワーク設計: 200万円
  - 機器調達・設置: 400万円
  - 配線工事: 100万円
  - 設定・テスト: 100万円

機器・ライセンス: 600万円
  - ネットワーク機器: 300万円
  - WiFi AP・小型機器: 200万円
  - ソフトウェアライセンス: 100万円

初期費用合計: 1,400万円
```

## 9. パフォーマンス目標

### 9.1 サービス品質目標
```yaml
可用性:
  - 基幹ネットワーク: 99.9%
  - 住民向けWiFi: 99.5%
  - IoTネットワーク: 99.0%

性能:
  - インターネット接続: 最大1Gbps
  - 住民WiFi: 10Mbps/人保証
  - IoT通信: 遅延 < 100ms
  - 音声通話: 遅延 < 50ms

容量:
  - 同時接続ユーザー: 1,500人
  - IoTデバイス: 1,000台
  - ピークトラフィック: 2Gbps
```

### 9.2 ユーザー体験目標
```yaml
住民向け:
  - WiFi接続時間: < 30秒
  - Webページ表示: < 3秒
  - 動画ストリーミング: 1080p安定再生

職員向け:
  - VPN接続時間: < 10秒
  - 業務システムアクセス: < 2秒
  - ファイル共有: 10MB/秒以上

IoT・センサー:
  - データ送信間隔: 1-60分（用途別）
  - バッテリー駆動: 1年以上
  - エラー率: < 1%
```

## 10. 将来拡張計画

### Phase 4: 6G準備・高度AI（3-5年後）
```yaml
次世代技術:
  - 6G通信規格対応
  - AI Network Intelligence
  - 自動ネットワーク最適化
  - デジタルツイン統合

追加コスト: 月額+10万円
```

### Phase 5: 他都市連携・広域ネットワーク（5-10年後）
```yaml
広域展開:
  - 近隣都市との専用線接続
  - 広域災害対応ネットワーク
  - 自治体間データ連携
  - 国際標準規格対応

追加コスト: 月額+20万円
```

この設計により、キャリアの信頼性とAzureの柔軟性を組み合わせた、1000人規模の都市に最適化された高品質で費用対効果の高いネットワーク基盤を構築できます。